<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.7/css/all.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/@media1200.css">
    <link rel="stylesheet" href="../css/@media1440.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/criar-chamado.css">
    <title>Ordem</title>
</head>

<body>
    <header>
        <div class="logo">

            <h1><a href="./home.html">Thermal Tech</a></h1>
        </div>
        <nav>
            <ul>
                <li><a href="http://localhost:5000/Equipamentos">Equipamentos</a></li>
                <li><a href="http://localhost:5000/manutencao">Manutenções</a></li>
                <li><a href="http://localhost:5000/consulta_ordem">Consultar Ordens</a></li>
                <li><a href="http://localhost:5000/chamado">Chamados</a></li>
                <li><a href="http://localhost:5000/cadastro">Cadastro Geral</a></li>
                <li><a href="http://localhost:5000/relatorio">Homem Hora</a></li>
                <li><a href="">Gráficos gerenciais</a></li>
                <li><a href="../pages/chat.html">Chat</a></li>
            </ul>
        </nav>
        <div class="nav-right">
            <div>
                <a href="#" class="config"><img src="../assets/icon_config.png" alt=""></a>
                <a href="#" class="sair" onclick="logout()"><img src="../assets/icon_sair.png" alt=""></a>
            </div>
            <div>
                <h4 id="userEmail"></h4>
            </div>
        </div>
    </header>
    <section>
        <section>
            <main>
                <section>
                    <div class="title-page">
                        <h2>Criar ordem de manutenção</h2>
                        <form action="/criar/ordem" method="post">
                    </div>
                    <div class="icons">
                            <button type="submit"><img src="../assets/save.png" onclick="salvarOrdem()" alt=""></button>
                            <button type="button"><img src="../assets/delete.png" onclick="deletarOrdem()" alt=""></button>
                            <button type="button"><img src="../assets/print.png" onclick="imprimirOrdem()"></button>
                            <button type="button" onclick="document.getElementById('fileInput').click();" id="btn-anexo">
                                <img src="../assets/anexos.png" alt="">
                            </button>
                    </div>
                    <div class="header-order">
                        <div class="info-header-order">
                            <label for="">Ordem</label>
                            <input type="number" id="ordem" placeholder="40001" name="num_ordem">
                            <input type="text" id="title-order" name="titulo_ord" value="Correção de dreno ACS-2101">
                        </div>
                        <div class="info-header-order">
                            <label for="">Status</label>
                            <input type="number" value="1" style="display: none;" name="status">
                            <input type="text" value="ABERTA" readonly>
                            <br>
                            <label for="">Chamado</label>
                            <input type="number" value="" name="num_chamado" id="numeroChamado" oninput="mostrarDadosChamado('<%= JSON.stringify(chamados) %>', '<%= JSON.stringify(equipamento)%>')">
                        </div>
                    </div>
                </section>
            </main>
            <div class="nav_infos">
                <button type="button" onclick="hideElements()">Cabeçalho</button>
                <button type="button" onclick="showElements()">Chamado</button>
            </div>
            <main class="chamado section_chamado display_none">
                <section class="dados_chamado">
                    <h3>Dados</h2>
                </section>
                <div class="title">
                    <h3>Referencias do objeto</h3>
                </div>
                <div class="dados">
                    <div class="info-header-order">
                        <label class="label-margin" for="">Localidade</label>
                        <input type="text" placeholder="Refeitório" id="localidadeCampo" class="data-chamado" value=''>
                    </div>
                    <div class="info-header-order">
                        <label class="label-margin" for="">Setor</label>
                        <input type=" text" placeholder="U-144" id="setorCampo" class="data-chamado">
                    </div>
                    <div class="info-header-order">
                        <label class="label-margin for=">Equipamento</label>
                        <input type=" text" placeholder="ACS-2101" id="equipamentoCampo" class="data-chamado">
                    </div>
                    <div class="info-header-order">
                        <label class="label-margin for=">Descrição</label>
                        <input type=" text" style="width: 300px;" id="descricaoEquipamentoCampo" placeholder="Ar condiconado; 220v; split; 24000 btus"
                            class="data-chamado">
                    </div>
                </div>
            </main>
            <main class="responsabilidades section_chamado display_none">
                <div class="title">
                    <h3>Responsabilidades</h3>
                </div>
                <div class="tecs info-header-order">
    
                    <Label>Prioridade</Label>
                    <div class="prioridade">
                        Alta
                        <input class="data-chamado" type="radio" id="priAlta" class="radio-button__input" id="radio1">
                        Média
                        <input class="data-chamado" type="radio"  id="priMedia"class="radio-button__input" id="radio2">
                        Baixa
                        <input class="data-chamado" type="radio" id="priBaixa" class="radio-button__input" id="radio3">
                        
                    </div>
                </div>
                <div class="user info-header-order">
                    <div>
                        <label for="">Criado por</label>
                        <input class="data-chamado" type="text" id="criadorCampo" placeholder="Jean Victor Maciel dos Santos" style="width: 320px;">
                        <input class="data-chamado" type="email"  id="emailCampo" style="width: 320px;"placeholder="ens-jeanvictor@ugv.edu.br">
                    </div>
                    <div style="padding-top: 5px;">
                        <label for="">Data chamado</label>
                        <input class="data-chamado" type="date"  id="dataCampo">
                        <input class="data-chamado" type="time"  id="horaCampo">
                    </div>
                </div>
            </main>
            <main class="objetivo section_chamado display_none">
                <div class="title">
                    <h3>Objetivo</h3>
                </div>
                <div class="info-header-order">
                    <label for="">Descrição</label>
                    <input class="data-chamado" type="text" id="descChaCampo" placeholder="Correção de dreno ACS-2101" style="width: 280px;">
                    <input class="data-chamado" id="fileInput" type="file" style="display:none;">
                </div>
                <div class="descrição">
                    <textarea class="data-chamado" name="" id="descricaoCampo" cols="30" rows="10"
                        style="width: 100%;padding: 5px;">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Magni exercitationem expedita assumenda repellendus, distinctio eaque neque consectetur iusto eligendi rerum cupiditate fugiat itaque sint illum facere quae explicabo fugit rem.Magni officiis, expedita a quasi quisquam non fugit facilis. Sit placeat reiciendis iusto odit deleniti facere sed non consequatur minus, nemo omnis dolorem quae vitae vel pariatur labore distinctio voluptas.</textarea>
                </div>
            </main>
            <section class="section_order">
                <main style="width: 60%;">
                    <div class="info-header-order">
                        <div class="title">
                            <h3>Responsabilidades</h3>
                        </div>
                        <div>
                            <label for="">Criado por</label>
                            <input class="data-chamado" type="text" id="email" name="criador" style="width: 320px;">
                        </div>
                    </div>
                </main>
                <main style="width: 60%;">
                    <div class="info-header-order">
                        <div class="title">
                            <h3>Datas</h3>
                        </div>
                        <div>
                            <label for="">Inicio</label>
                            <input class="data-chamado" id="data-init-ordem" name="data_inicio" type="date">
                            <input type="time" id="hora-init-ordem" name="hora_inicio">
                            <label for="">Prioridade</label>
                            <select name="prioridade" id="">
                                <option value="1">1- Alta</option>
                                <option value="2">2- Média</option>
                                <option value="3">3- Baixa</option>
                               
                            </select>
                            <div>
                                <label for="">Fim</label>
                                <input type="date" name="data_fim">
                                <input type="time" name="hora_fim">
                                <label for="">Tipo Manutenção</label>
                                <select name="tipo_manut" id="">
                                    <option value=""></option>
                                    <option value="1">Corretiva</option>
                                    <option value="2">Preventiva</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </main>
                <main style="width: 60%;">
                    <div class="info-header-order">
                        <div class="title">
                            <h3>Confirmações</h3>
                        </div>
                        <label for="">Técnico resp.</label>
                        <input type="number" placeholder="41248466" name="matricula" style="width: 90px;">
                        <input type="text" value="Lucas Silva Cuba">
                        <label for="">Data de lanç.</label>
                        <input type="date" name="data_lancamento">
                        <div>
                            <label for="">Inicio do trabalho</label>
                            <input type="date" name="data_inicio_trabalho">
                            <input type="time" step="1" name="hora_inicio_trabalho">
                        </div>
                        <div>
                            <label for="">Fim do Trabalho</label>
                            <input type="date" name="data_fim_trabalho">
                            <input type="time" step="1" name="data_fim_trabalho">
                        </div>
                        <div>
                            <label for="">Texto do serviço</label>
                            <textarea name="desc_manut" id="" cols="60" rows="2"></textarea>
                        </div>
                    </div>
                </main>
                <main style="width: 60%;">
                    <div class="title">
                        <h3>Dados total Confirmações</h3>
                    </div>
                    <div class="info-header-order">
                        <label for="">Dias acumulado</label>
                        <input type="number" style="width: 40px;" value="2">
                        <input type="text" style="width: 40px;" value="DIA">
                        <label for="">Tempo de duração</label>
                        <input type="time" value="02:00">
                        <input type="text" value="Horas" style="width: 50px;">
                        <div style="margin-top: 10px;">
                            Confirmação final
                            <input type="checkbox" id="">
                            Necessida revisão?
                            <input type="checkbox">
                        </div>
                    </div>
                </form>
                </main>
            </section>
                </section>
            </main>
        </section>

        <script>
            function mostrarUser() {
            const userEmail = localStorage.getItem("userEmail");
            const EmailCriador = document.getElementById("email")

            // Insere o email no elemento HTML correspondente
            document.getElementById("userEmail").innerHTML = userEmail;
            EmailCriador.value = userEmail;
        }
        mostrarUser()

        function atualizarDataHora() {
  const dataOrdem = document.getElementById("data-init-ordem");
  const horaOrdem = document.getElementById("hora-init-ordem");

  const agora = new Date();

  // Formate a data no formato "yyyy-MM-dd" para o campo de data
  const dia = String(agora.getDate()).padStart(2, '0');
  const mes = String(agora.getMonth() + 1).padStart(2, '0');
  const ano = agora.getFullYear();
  const dataFormatada = `${ano}-${mes}-${dia}`;
  dataOrdem.value = dataFormatada;

  // Formate a hora no formato "HH:mm" para o campo de hora
  const horaFormatada = agora.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  horaOrdem.value = horaFormatada;
}

// Atualize a data e a hora a cada segundo (1000 milissegundos)
setInterval(atualizarDataHora, 1000);

// Chame a função uma vez para configurar os valores iniciais
atualizarDataHora();


window.addEventListener('load', function () {
    fetch('/proximo-numero-ordem')
        .then(response => response.json())
        .then(data => {
            // Atualize o valor do campo de entrada com o próximo número da ordem
            document.getElementById('ordem').value = data.proximaOrdem;
        })
        .catch(error => console.error(error));
});
document.querySelector('form').addEventListener('keydown', function(event) {
  if (event.key === 'Enter') {
      event.preventDefault();
      return false;
  }
});

function mostrarDadosChamado(chamado, equipamentos) {
    const chamadosObj = JSON.parse(chamado);
    const equipamentosObj = JSON.parse(equipamentos);

    const numeroChamado = parseInt(document.getElementById('numeroChamado').value);

    const chamadoSelecionado = chamadosObj.find(chamado => chamado.id_chamado === numeroChamado);

    if (chamadoSelecionado) {
        // Função para formatar a data em um formato compatível com input date
        function formatarDataParaInputDate(data) {
            const dataObj = new Date(data);
            const ano = dataObj.getFullYear();
            const mes = (dataObj.getMonth() + 1).toString().padStart(2, '0');
            const dia = dataObj.getDate().toString().padStart(2, '0');
            return `${ano}-${mes}-${dia}`;
        }

        // Encontre o equipamento correspondente com base no ID
        const idEquipamento = chamadoSelecionado.equipamento_cha;
        const equipamentoAssociado = equipamentosObj.find(equipamento => equipamento.id_equip === idEquipamento);

        if (equipamentoAssociado) {
            const prioridade = chamadoSelecionado.prioridade_cha;

            // Selecione o campo de rádio correto com base na prioridade
            if (prioridade === 1) {
                document.getElementById('priBaixa').checked = true;
            } else if (prioridade === 2) {
                document.getElementById('priMedia').checked = true;
            } else if (prioridade === 3) {
                document.getElementById('priAlta').checked = true;
            }

            // Preencha os campos do formulário com informações do chamado e equipamento
            document.getElementById('dataCampo').value = formatarDataParaInputDate(chamadoSelecionado.data_ini_cha);
            document.getElementById('horaCampo').value = chamadoSelecionado.hora_ini_cha;
            document.getElementById('descChaCampo').value = chamadoSelecionado.descricao_cha;
            document.getElementById('descricaoCampo').value = chamadoSelecionado.descri_cha;
            document.getElementById('criadorCampo').value = chamadoSelecionado.criado_por_cha;
            document.getElementById('emailCampo').value = chamadoSelecionado.email;
            document.getElementById('equipamentoCampo').value = equipamentoAssociado.tag_listequip;
            document.getElementById('setorCampo').value = equipamentoAssociado.nome_setor;
            document.getElementById('localidadeCampo').value = equipamentoAssociado.localidade_listequip;
            document.getElementById('descricaoEquipamentoCampo').value = equipamentoAssociado.descricao_listequip;
        } else {
            console.log("Equipamento não encontrado para este chamado");
            limparCampos(); // Adicionamos a limpeza dos campos aqui
        }
    } else {
        console.log("Chamado não encontrado");
        limparCampos(); // Adicionamos a limpeza dos campos aqui
    }
}

function limparCampos() {
    // Limpeza dos campos de input
    document.getElementById('dataCampo').value = '';
    document.getElementById('horaCampo').value = '';
    document.getElementById('descChaCampo').value = '';
    document.getElementById('descricaoCampo').value = '';
    document.getElementById('criadorCampo').value = '';
    document.getElementById('emailCampo').value = '';
    document.getElementById('equipamentoCampo').value = '';
    document.getElementById('setorCampo').value = '';
    document.getElementById('localidadeCampo').value = '';
    document.getElementById('descricaoEquipamentoCampo').value = '';
    // Limpeza dos campos de radio
    document.getElementById('priBaixa').checked = false;
    document.getElementById('priMedia').checked = false;
    document.getElementById('priAlta').checked = false;
}








        </script>
        <script src="../Login_v1/firebase-init.js"></script>
        <script src="../js/auth-guard.js"></script>
        <script src="../js/logout.js"></script>
        <script src="../js/script.js"></script>
        <script src="../js/auth-guard.js"></script>
        <link rel="stylesheet" href="../css/@media1440.css">
        <link rel="stylesheet" href="../css/@media1200.css">
    </body>